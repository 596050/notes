<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://notes.shichao.io/apue/ch4/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Chapter 4. Files and Directories - Shichao's Notes</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../custom.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Shichao's Notes</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">APUE <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../ch1/">Chapter 1. UNIX System Overview</a>
                        </li>
                    
                        <li >
                            <a href="../ch2/">Chapter 2. UNIX Standardization and Implementations</a>
                        </li>
                    
                        <li >
                            <a href="../ch3/">Chapter 3. File I/O</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">Chapter 4. Files and Directories</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">UTLK <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../utlk/ch1/">Chapter 1. Introduction</a>
                        </li>
                    
                        <li >
                            <a href="../../utlk/ch2/">Chapter 2. Memory Addressing</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">UNP <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../unp/ch1/">Chapter 1. Introduction</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../golang/">Golang</a>
                </li>
            
            
            
                <li >
                    <a href="../../bash/">Bash</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../ch3/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../../utlk/ch1/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/shichao-an/notes">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#chapter-4-files-and-directories">Chapter 4. Files and Directories</a></li>
        
            <li><a href="#restrict-keyword">restrict keyword</a></li>
        
            <li><a href="#stat-fstat-fstatat-and-lstat-functions">stat, fstat, fstatat, and lstat Functions</a></li>
        
            <li><a href="#file-types">File Types</a></li>
        
            <li><a href="#set-user-id-and-set-group-id">Set-User-ID and Set-Group-ID</a></li>
        
            <li><a href="#file-access-permissions">File Access Permissions</a></li>
        
            <li><a href="#ownership-of-new-files-and-directories">Ownership of New Files and Directories</a></li>
        
            <li><a href="#access-and-faccessat-functions">access and faccessat Functions</a></li>
        
            <li><a href="#umask-function">umask Function</a></li>
        
            <li><a href="#chmod-fchmod-and-fchmodat-functions">chmod, fchmod, and fchmodat Functions</a></li>
        
            <li><a href="#sticky-bit">Sticky Bit</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h2 id="chapter-4-files-and-directories">Chapter 4. Files and Directories</h2>
<p>This chapter centers on I/O for regular files.</p>
<h3 id="restrict-keyword"><code>restrict</code> keyword</h3>
<p>Added in C99, <a href="https://en.wikipedia.org/wiki/Restrict"><code>restrict</code></a> keyword is used to tell the compiler which pointer references can be optimized, by indicating that the object to which the pointer refers is accessed in the function only via that pointer. [p26]</p>
<h3 id="stat-fstat-fstatat-and-lstat-functions"><code>stat</code>, <code>fstat</code>, <code>fstatat</code>, and <code>lstat</code> Functions</h3>
<blockquote>
<p><a href="https://gist.github.com/shichao-an/dd0cdd90a54848ff3018">Functions</a></p>
</blockquote>
<ul>
<li><code>stat</code>: returns a structure of information about the named file</li>
<li><code>fstat</code>: returns a structure of information about the given file descriptor</li>
<li><code>lstat</code>: similar to <code>stat</code>, returns information about the symbolic link, not the file referenced by the symbolic link</li>
<li><code>fstatat</code>:  return the file statistics for a pathname relative to an open directory represented by the fd argument; the flag argument controls whether symbolic links are followed</li>
</ul>
<p>The <code>buf</code> argument is a pointer to a <a href="http://en.wikipedia.org/wiki/Stat_(system_call)#stat_structure">structure</a> that we must supply. The functions fill in the structure.</p>
<h3 id="file-types">File Types</h3>
<ul>
<li>Regular file. All binary executable files conform to a format that allows the kernel to identify where to load a programâ€™s text and data.</li>
<li>Directory file. A file that contains the names of other files and pointers to information on these files. Any process that has read permission for a directory file can read the contents of the directory, but only the kernel can write directly to a directory file.</li>
<li>Block special file</li>
<li>Character special file</li>
<li>FIFO</li>
<li>Socket</li>
<li>Symbolic link</li>
</ul>
<p>This program in prints the type of file for each command-line argument.</p>
<ul>
<li><a href="https://github.com/shichao-an/apue.3e/blob/master/filedir/filetype.c">filetype.c</a></li>
</ul>
<h3 id="set-user-id-and-set-group-id">Set-User-ID and Set-Group-ID</h3>
<h3 id="file-access-permissions">File Access Permissions</h3>
<ol>
<li>Whenever we want to open any type of file by name, we must have execute permission in each directory mentioned in the name, including the current directory, if it is implied. Read permission for a directory and execute permission for a directory mean different things. Read permission lets us read the directory, obtaining a list of all the filenames in the directory. Execute permission lets us pass through the directory when it is a component of a pathname that we are trying to access. [p100]</li>
<li>We cannot create a new file in a directory unless we have write permission and execute permission in the directory.</li>
</ol>
<h3 id="ownership-of-new-files-and-directories">Ownership of New Files and Directories</h3>
<ol>
<li>The user ID of a new file is set to the effective user ID of the process</li>
<li>The group ID of a new file can be the effective group ID of the process; or group ID of the directory in which the file is being created.</li>
</ol>
<p>FreeBSD 8.0 and Mac OS X 10.6.8 always copy the new fileâ€™s group ID from the directory. </p>
<h3 id="access-and-faccessat-functions"><code>access</code> and <code>faccessat</code> Functions</h3>
<blockquote>
<p><a href="https://gist.github.com/shichao-an/a0d8ab4d744d51be289f">Functions</a></p>
</blockquote>
<p>These functions test accessibility based on the real user and group IDs.</p>
<p>The <code>flag</code> argument can be used to change the behavior of <code>faccessat</code>. If the <code>AT_EACCESS</code> flag is set, the access checks are made using the effective user and group IDs </p>
<ul>
<li><a href="https://github.com/shichao-an/apue.3e/blob/master/filedir/access.c">access.c</a></li>
</ul>
<h3 id="umask-function"><code>umask</code> Function</h3>
<p>The Single UNIX Specification requires that the <code>umask</code> command support a symbolic mode of operation. Unlike the octal format, the symbolic format specifies which permissions are to be allowed instead of which ones are to be denied.</p>
<pre><code class="text">$ umask  # first print the current file mode creation mask
002
$ umask -S  # print the symbolic form
u=rwx,g=rwx,o=rx
$ umask 027  # print the symbolic form
$ umask -S  # print the symbolic form
u=rwx,g=rx,o=
</code></pre>

<h3 id="chmod-fchmod-and-fchmodat-functions"><code>chmod</code>, <code>fchmod</code>, and <code>fchmodat</code> Functions</h3>
<blockquote>
<p><a href="https://gist.github.com/shichao-an/9fa2e6e7e6e600cb62c1">Functions</a></p>
</blockquote>
<p><code>chmod</code> automatically clear the following permission bits under the following conditions:</p>
<ol>
<li>Setting sticky bit on a regular file without superuser privileges (Solaris)</li>
<li>If the group ID of the new file does not equal either the effective group ID of the process or one of the processâ€™s supplementary group IDs and if the process does not have superuser privileges, then the set-group-ID bit is automatically turned off. On FreeBSD 8.0, Linux 3.2.0 and Mac OS X 10.6.8, if a process that does not have superuser privileges writes to a file, the set-user-ID and set-group-ID bits are automatically turned off.</li>
</ol>
<h3 id="sticky-bit">Sticky Bit</h3>
<p>Sticky Bit (<code>S_ISVTX</code>), or saved-text bit in the later versions of the UNIX System.</p>
<ul>
<li>On file: only on a minority of systems</li>
<li>On directory: <code>/tmp</code> and <code>/var/tmp</code></li>
</ul></div>
        </div>

        

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>
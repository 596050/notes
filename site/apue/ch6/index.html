<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://notes.shichao.io/apue/ch6/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Chapter 6. System Data Files and Information - Shichao's Notes</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../custom.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Shichao's Notes</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">APUE <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../ch1/">Chapter 1. UNIX System Overview</a>
                        </li>
                    
                        <li >
                            <a href="../ch2/">Chapter 2. UNIX Standardization and Implementations</a>
                        </li>
                    
                        <li >
                            <a href="../ch3/">Chapter 3. File I/O</a>
                        </li>
                    
                        <li >
                            <a href="../ch4/">Chapter 4. Files and Directories</a>
                        </li>
                    
                        <li >
                            <a href="../ch5/">Chapter 5. Standard I/O Library</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">Chapter 6. System Data Files and Information</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">UTLK <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../utlk/ch1/">Chapter 1. Introduction</a>
                        </li>
                    
                        <li >
                            <a href="../../utlk/ch2/">Chapter 2. Memory Addressing</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">UNP <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../unp/ch1/">Chapter 1. Introduction</a>
                        </li>
                    
                        <li >
                            <a href="../../unp/ch2/">Chapter 2. The Transport Layer: TCP, UDP, and SCTP</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">ICND <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../icnd1/part1/">ICND1 Part I: Networking Fundamentals</a>
                        </li>
                    
                        <li >
                            <a href="../../icnd2/part1/">ICND2 Part I: LAN Switching</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">TCPv1 <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../tcpv1/ch1/">Chapter 1. Introduction</a>
                        </li>
                    
                        <li >
                            <a href="../../tcpv1/ch2/">Chapter 2. The Internet Address Architecture</a>
                        </li>
                    
                        <li >
                            <a href="../../tcpv1/headers/">Headers</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Others <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../htae/">HTAE</a>
                        </li>
                    
                        <li >
                            <a href="../../golang/">Go</a>
                        </li>
                    
                        <li >
                            <a href="../../bash/">Bash</a>
                        </li>
                    
                        <li >
                            <a href="../../c/">C</a>
                        </li>
                    
                        <li >
                            <a href="../../iptables/">iptables</a>
                        </li>
                    
                        <li >
                            <a href="../../nginx/">Nginx</a>
                        </li>
                    
                        <li >
                            <a href="../../vim/">Vim</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../ch5/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../../utlk/ch1/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/shichao-an/notes">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#chapter-6-system-data-files-and-information">Chapter 6. System Data Files and Information</a></li>
        
            <li><a href="#password-file">Password File</a></li>
        
            <li><a href="#shadow-passwords">Shadow Passwords</a></li>
        
            <li><a href="#group-file">Group File</a></li>
        
            <li><a href="#supplementary-group-ids">Supplementary Group IDs</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h2 id="chapter-6-system-data-files-and-information">Chapter 6. System Data Files and Information</h2>
<p>This chapter covers portable interfaces to data files, system identification functions and the time and date functions.</p>
<h3 id="password-file">Password File</h3>
<p>The UNIX System's password file, called the user database by POSIX.1, contains the following fields:</p>
<p><a href="../figure_6.1.png" title="Figure 6.1 Fields in /etc/passwd file"><img alt="Figure 6.1 Fields in /etc/passwd file" src="../figure_6.1_600.png" /></a></p>
<p>Historically, the password file has been stored in <code>/etc/passwd</code> and has been an ASCII file.</p>
<ul>
<li><code>root</code> has a user ID of 0 (superuser)</li>
<li>The encrypted password field contains a single character as a placeholder (<code>x</code>) </li>
<li>Some fields can be empty</li>
<li>The shell field contains the user's login shell. The default value for an empty shell field is usually <code>/bin/sh</code>. Other executable that prevents a user from loggin in to a system:<ul>
<li><code>/dev/null</code></li>
<li><code>/bin/false</code>: exits with an unsuccessful (nonzero) status</li>
<li><code>/bin/true</code>: exits with a successful (zero) status</li>
<li><code>nologin</code>: prints a customizable error message and exits with a nonzero exit status</li>
</ul>
</li>
<li><code>nobody</code> user name can be used to allow people to log in to a system, but with a user ID (65534) and group ID (65534) that provide no privileges.</li>
<li>Some systems that provide the <code>finger(1)</code> command support additional information in the comment field</li>
</ul>
<p>Some systems provide the <code>vipw</code> command to allow administrators to edit the password file.</p>
<script src="https://gist.github.com/shichao-an/00b608f959de8dad0b1b.js"></script>

<ul>
<li><code>getpwuid</code>: used by the <code>ls(1)</code> program to map the numerical user ID contained in an i-node into a user's login name.</li>
<li><code>getpwnam</code>: used by the <code>login(1)</code> program when we enter our login name</li>
</ul>
<p>Both functions return a pointer to a passwd structure that the functions fill in. This structure is usually a static variable within the function, so its contents are overwritten each time we call either of these functions.</p>
<script src="https://gist.github.com/shichao-an/ffbbc20702760d6a4fab.js"></script>

<ul>
<li><code>getpwent</code>: returns the next entry (a pointer to a structure that it has filled in, this structure is overwritten each time we call this function) in the password file.</li>
<li><code>setpwent</code>: rewinds files</li>
<li><code>endpwent</code>: closes files</li>
</ul>
<p>Example:</p>
<ul>
<li><a href="https://github.com/shichao-an/apue.3e/blob/master/datafiles/getpwnam.c">getpwnam.c</a></li>
</ul>
<p><code>setpwent</code> at the beginning of this function is self-defense: we ensure that the files are rewound, in case the caller has already opened them by calling getpwent.</p>
<h3 id="shadow-passwords">Shadow Passwords</h3>
<p>Systems store the encrypted password in another file, often called the <strong>shadow password file</strong>. Minimally, this file has to contain the user name and the encrypted password.</p>
<p><a href="../figure_6.3.png" title="Figure 6.3 Fields in /etc/shadow file"><img alt="Figure 6.3 Fields in /etc/shadow file" src="../figure_6.3_600.png" /></a></p>
<p>The shadow password file should not be readable by the world. Only a few programs need to access encrypted passwords, e.g. <code>login(1)</code> and <code>passwd(1)</code>, and these programs are often set-user-ID root. With shadow passwords, the regular password file, <code>/etc/passwd</code>, can be left readable by the world.</p>
<script src="https://gist.github.com/shichao-an/bad119e8e6ed442e25bf.js"></script>

<h3 id="group-file">Group File</h3>
<p>The UNIX System’s group file, called the group database by POSIX.1, contains the following fields:</p>
<p><a href="../figure_6.4.png" title="Figure 6.4 Fields in /etc/group file"><img alt="Figure 6.4 Fields in /etc/group file" src="../figure_6.4_600.png" /></a></p>
<p>The field <code>gr_mem</code> is an array of pointers to the user names that belong to this group. This array is terminated by a null pointer.</p>
<script src="https://gist.github.com/shichao-an/c280f5fa5d15b006e8af.js"></script>

<p>Like the password file functions, both of these functions normally return pointers to a static variable, which is overwritten on each call.</p>
<script src="https://gist.github.com/shichao-an/98d14c0850ac1f357993.js"></script>

<ul>
<li><code>getgrent</code>: reads the next entry from the group file, opening the file first, if it’s not already open</li>
</ul>
<h3 id="supplementary-group-ids">Supplementary Group IDs</h3>
<p><code>newgrp(1)</code> can be used to change the real group ID to the new group’s ID. We could always go back to our original group (as listed in <code>/etc/passwd</code>) by executing <code>newgrp</code> without any arguments.</p>
<p>With 4.2BSD, the concept of <strong>supplementary group IDs</strong> was introduced. The file access permission checks were modified so that in addition to comparing the the file’s group ID to the process effective group ID, it was also compared to all the supplementary group IDs.</p>
<p>The constant <code>NGROUPS_MAX</code> specifies the number of supplementary group IDs.</p>
<script src="https://gist.github.com/shichao-an/72cd85f9279a4501249c.js"></script>

<ul>
<li><code>getgroups</code><ul>
<li><em>gidsetsize</em> &gt; 0: the function fills in the array up to <em>gidsetsize</em> supplementary group IDs</li>
<li><em>gidsetsize</em> = 0: the function returns only the number of supplementary group IDs; <code>grouplist</code> is not modified</li>
</ul>
</li>
<li><code>setgroups</code>: called by the superuser to set the supplementary group ID list for the calling process</li>
<li><code>initgroups</code>: reads the entire group file with the functions <code>getgrent</code>, <code>setgrent</code>, and <code>endgrent</code> and determines the group membership for username.  It then calls setgroups to initialize the supplementary group ID list for the user. It includes <em>basegid</em> in the supplementary group ID list; basegid is the group ID from the password file for username. See <a href="http://www.gnu.org/software/libc/manual/html_node/Setting-Groups.html">Setting the Group IDs</a></li>
</ul></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>